services:
  # Need to copy instead of mount directly until RW is supported
  init:
    image: busybox
    command: sh -c 'cp -rp /init/* /var/lib/postgresql/data/'
    volumes:
      - db-data:/var/lib/postgresql/data
      - type: image
        source: laurentgoderre689/test-data:17
        target: /init
  
  postgres:
    image: postgres:17-alpine
    volumes:
      - db-data:/var/lib/postgresql/data
    depends_on:
      init:
         condition: service_completed_successfully

  client:
    image: postgres:17-alpine
    command: ["sh", "-c", "sleep 2 && psql -h postgres -c \"SELECT * FROM humanresources.employee WHERE jobtitle LIKE 'Chief%'\""]
    environment:
      PGUSER: postgres
      PGPASSWORD: '1234'
      PGDATABASE: Adventureworks
    depends_on:
      - postgres

volumes:
  db-data:
